{
  "hash": "019d9df56f601b176fc099a5a14a05c3",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Regression Fundamentals: Beyond Linearity\"\nformat:\n  html: default\n  ipynb: default\n---\n\nIn previous sessions, we learned how linear regression works: fit a straight line to data, minimise prediction error, and use that line for prediction and inference. Linear regression is powerful, but it assumes relationships are linear. In reality, data often follows curves, has constraints, or exhibits patterns that straight lines can't capture.\n\nThis session explores how the linear regression framework is adapted to non-linear patterns, using generalised linear models (GLMs), through **link functions**. We'll see that the same core idea, fitting a line through data to describe the relationship between variables, works for binary outcomes, counts, and other constrained data types. The key is transforming the scale so linear models can work.\n\nWe'll focus on **logistic regression** for binary outcomes, implement it with real data, and briefly introduce other extensions like multilevel models and GAMs.\n\n# Slides\n\nUse the left ⬅️ and right ➡️ arrow keys to navigate through the slides below. To view in a separate tab/window, [follow this link](slides.html){target=\"_blank\"}.\n\n<iframe src=\"slides.html\" height=\"500\" width=\"100%\"></iframe>\n\n## When Linear Regression Fails\n\nLinear regression assumes the relationship between predictors and outcome is linear. This works when each unit increase in $X$ produces a constant change in $Y$. But many real-world relationships don't follow this pattern.\n\n### Examples of Non-Linear Data\n\n- Binary outcomes - Survived/died, yes/no, pass/fail. Outcomes are 0 or 1, not continuous.\n- Count data - Number of hospital visits, customer complaints. Must be non-negative integers.\n- Proportions - Percentage passing an exam, recovery rates. Bounded between 0 and 1.\n- Growth curves - Disease spread, population growth. Exponential or S-shaped patterns.\n\nForcing linear regression onto these data types produces nonsensical predictions (probabilities above 1, negative counts) and violates model assumptions.\n\n## The Problem Illustrated\n\n::: {#cell-problem-demo .cell execution_count=1}\n``` {.python .cell-code}\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.linear_model import LinearRegression, LogisticRegression\n\n# set visualisation style\nsns.set_theme(style=\"whitegrid\")\nplt.rcParams['figure.figsize'] = (10, 6)\n\n# simulate binary outcome data\nnp.random.seed(42)\nage = np.linspace(20, 80, 100)\nprob_true = 1 / (1 + np.exp(-(age - 50) / 8))\ndisease = np.random.binomial(1, prob_true)\n\n# fit linear regression\nmodel_linear = LinearRegression()\nmodel_linear.fit(age.reshape(-1, 1), disease)\npred_linear = model_linear.predict(age.reshape(-1, 1))\n\n# plot\nfig, ax = plt.subplots(figsize=(10, 6))\nsns.scatterplot(x=age, y=disease, facecolors='white', edgecolors='black',\n                s=60, linewidths=1, alpha=0.7, ax=ax)\nsns.lineplot(x=age, y=pred_linear, color='#ED8B00', linewidth=2, ax=ax, label='Linear Model')\nax.axhline(y=0, color='red', linestyle='--', alpha=0.5, label='Valid Range')\nax.axhline(y=1, color='red', linestyle='--', alpha=0.5)\nax.set_xlabel('Age')\nax.set_ylabel('Disease (0 = No, 1 = Yes)')\nax.set_title('Linear Regression on Binary Data: Predictions Outside Valid Range')\nax.set_ylim(-0.2, 1.2)\nax.legend()\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/problem-demo-output-1.png){#problem-demo}\n:::\n:::\n\n\nLinear regression predicts values below 0 and above 1, which make no sense for binary outcomes.\n\n## The Solution - Link Functions\n\nGeneralised linear models adapt the linear model framework to work with non-linear data. Link functions transform the scale so that a linear model fits the data. Instead of fitting a line directly to constrained data, we:\n\n1. Transform the outcome to an unbounded scale\n2. Fit a linear model on the transformed scale\n3. Transform predictions back to the original scale\n\nThis preserves the linearity of the model while respecting data constraints.\n\n<details>\n  <summary> How Logistic Regression Works (Click to Expand)</summary> \n\n### The Logit Link\n\nFor binary outcomes, we use the logit link, which models the log-odds.\n\n$$\n\\log\\left(\\frac{p}{1-p}\\right) = \\beta_0 + \\beta_1X\n$$\n\nThe left side of this equation is the log-odds for an outcome of probability $p$. This can be any value from $-\\infty$ to $+\\infty$. This is equivalent to the right side of the equation, which is the linear predictor we have encountered in previous sessions. \n\nTo get probabilities, we transform back using the inverse logit.\n\n$$\np = \\frac{1}{1 + e^{-(\\beta_0 + \\beta_1X)}}\n$$\n\nThis produces an S-shaped curve that stays between 0 and 1.\n\n### Why Log-Odds?\n\nOdds represent the ratio of success to failure: $\\frac{p}{1-p}$. If $p = 0.8$, odds are $\\frac{0.8}{0.2} = 4$ (4 to 1 in favour). Taking the log makes this unbounded:\n\n- $p = 0.5$ → odds = 1 → log-odds = 0\n- $p$ close to 0 → odds close to 0 → log-odds $\\to -\\infty$\n- $p$ close to 1 → odds $\\to \\infty$ → log-odds $\\to +\\infty$\n\nNow we can fit a linear model on the log-odds scale.\n\n</details>\n\n## Logistic Regression in Practice\n\nLet's implement logistic regression using the Titanic dataset. Our goal is to predict passenger survival based on characteristics like age, sex, and passenger class.\n\n### Load and Prepare Data\n\n::: {#load-titanic .cell execution_count=2}\n``` {.python .cell-code}\n# load titanic data\nurl = 'https://raw.githubusercontent.com/datasciencedojo/datasets/master/titanic.csv'\ntitanic = pd.read_csv(url)\n\n# select relevant columns and drop missing values\ndf = titanic[['Survived', 'Pclass', 'Sex', 'Age', 'Fare']].dropna()\n\n# convert sex to binary\ndf['Sex'] = (df['Sex'] == 'female').astype(int)\n\nprint(f\"Dataset shape: {df.shape}\")\nprint(\"\\nFirst few rows:\")\nprint(df.head(10))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nDataset shape: (714, 5)\n\nFirst few rows:\n    Survived  Pclass  Sex   Age     Fare\n0          0       3    0  22.0   7.2500\n1          1       1    1  38.0  71.2833\n2          1       3    1  26.0   7.9250\n3          1       1    1  35.0  53.1000\n4          0       3    0  35.0   8.0500\n6          0       1    0  54.0  51.8625\n7          0       3    0   2.0  21.0750\n8          1       3    1  27.0  11.1333\n9          1       2    1  14.0  30.0708\n10         1       3    1   4.0  16.7000\n```\n:::\n:::\n\n\n<details>\n  <summary> Exploratory Data Analysis (Click to Expand)</summary> \n\n\nBefore modelling, examine the relationships between predictors and survival.\n\n::: {#eda-survival-rate .cell execution_count=3}\n``` {.python .cell-code}\n# overall survival rate\nsurvival_rate = df['Survived'].mean()\nprint(f\"Overall survival rate: {survival_rate:.1%}\")\n\n# survival by sex\nsurvival_sex = df.groupby('Sex')['Survived'].mean()\nprint(\"\\nSurvival rate by sex:\")\nprint(survival_sex.to_frame().rename(columns={'Survived': 'Survival Rate'}))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOverall survival rate: 40.6%\n\nSurvival rate by sex:\n     Survival Rate\nSex               \n0         0.205298\n1         0.754789\n```\n:::\n:::\n\n\n::: {#cell-eda-plots .cell execution_count=4}\n``` {.python .cell-code}\nfig, axes = plt.subplots(2, 2, figsize=(14, 10))\n\n# survival by sex\nsurvival_sex = df.groupby('Sex')['Survived'].mean()\naxes[0, 0].bar(['Male', 'Female'], survival_sex.values, color=['#005EB8', '#ED8B00'])\naxes[0, 0].set_ylabel('Survival Rate')\naxes[0, 0].set_title('Survival Rate by Sex')\naxes[0, 0].set_ylim(0, 1)\n\n# survival by class\nsurvival_class = df.groupby('Pclass')['Survived'].mean()\naxes[0, 1].bar(survival_class.index, survival_class.values, color='#005EB8')\naxes[0, 1].set_xlabel('Passenger Class')\naxes[0, 1].set_ylabel('Survival Rate')\naxes[0, 1].set_title('Survival Rate by Class')\naxes[0, 1].set_ylim(0, 1)\n\n# age distribution by survival\nsns.histplot(data=df, x='Age', hue='Survived', bins=30, ax=axes[1, 0], \n             palette={0: '#ED8B00', 1: '#005EB8'}, alpha=0.6)\naxes[1, 0].set_title('Age Distribution by Survival')\naxes[1, 0].set_xlabel('Age')\naxes[1, 0].legend(['Died', 'Survived'])\n\n# fare distribution by survival\nsns.histplot(data=df, x='Fare', hue='Survived', bins=30, ax=axes[1, 1],\n             palette={0: '#ED8B00', 1: '#005EB8'}, alpha=0.6, log_scale=True)\naxes[1, 1].set_title('Fare Distribution by Survival (Log Scale)')\naxes[1, 1].set_xlabel('Fare (£)')\naxes[1, 1].legend(['Died', 'Survived'])\n\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/eda-plots-output-1.png){#eda-plots}\n:::\n:::\n\n\nWomen, first-class passengers, and children had higher survival rates. Fare correlates with class.\n\n</details>\n\n### Fitting a Logistic Regression Model\n\nWe'll fit two models: a simple model with only sex as a predictor, and a multiple model with all predictors.\n\n::: {#cell-fit-logistic .cell execution_count=5}\n``` {.python .cell-code}\nfrom sklearn.model_selection import train_test_split\nfrom sklearn.metrics import accuracy_score, confusion_matrix, classification_report\n\n# prepare data\nX = df[['Sex', 'Age', 'Pclass', 'Fare']]\ny = df['Survived']\n\n# split into train and test sets\nX_train, X_test, y_train, y_test = train_test_split(\n    X, y, test_size=0.2, random_state=42\n)\n\n# fit logistic regression\nclf = LogisticRegression(max_iter=1000)\nclf.fit(X_train, y_train)\n```\n\n::: {#fit-logistic .cell-output .cell-output-display execution_count=5}\n```{=html}\n<style>#sk-container-id-1 {\n  /* Definition of color scheme common for light and dark mode */\n  --sklearn-color-text: #000;\n  --sklearn-color-text-muted: #666;\n  --sklearn-color-line: gray;\n  /* Definition of color scheme for unfitted estimators */\n  --sklearn-color-unfitted-level-0: #fff5e6;\n  --sklearn-color-unfitted-level-1: #f6e4d2;\n  --sklearn-color-unfitted-level-2: #ffe0b3;\n  --sklearn-color-unfitted-level-3: chocolate;\n  /* Definition of color scheme for fitted estimators */\n  --sklearn-color-fitted-level-0: #f0f8ff;\n  --sklearn-color-fitted-level-1: #d4ebff;\n  --sklearn-color-fitted-level-2: #b3dbfd;\n  --sklearn-color-fitted-level-3: cornflowerblue;\n\n  /* Specific color for light theme */\n  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));\n  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));\n  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));\n  --sklearn-color-icon: #696969;\n\n  @media (prefers-color-scheme: dark) {\n    /* Redefinition of color scheme for dark theme */\n    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));\n    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));\n    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));\n    --sklearn-color-icon: #878787;\n  }\n}\n\n#sk-container-id-1 {\n  color: var(--sklearn-color-text);\n}\n\n#sk-container-id-1 pre {\n  padding: 0;\n}\n\n#sk-container-id-1 input.sk-hidden--visually {\n  border: 0;\n  clip: rect(1px 1px 1px 1px);\n  clip: rect(1px, 1px, 1px, 1px);\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  width: 1px;\n}\n\n#sk-container-id-1 div.sk-dashed-wrapped {\n  border: 1px dashed var(--sklearn-color-line);\n  margin: 0 0.4em 0.5em 0.4em;\n  box-sizing: border-box;\n  padding-bottom: 0.4em;\n  background-color: var(--sklearn-color-background);\n}\n\n#sk-container-id-1 div.sk-container {\n  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`\n     but bootstrap.min.css set `[hidden] { display: none !important; }`\n     so we also need the `!important` here to be able to override the\n     default hidden behavior on the sphinx rendered scikit-learn.org.\n     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */\n  display: inline-block !important;\n  position: relative;\n}\n\n#sk-container-id-1 div.sk-text-repr-fallback {\n  display: none;\n}\n\ndiv.sk-parallel-item,\ndiv.sk-serial,\ndiv.sk-item {\n  /* draw centered vertical line to link estimators */\n  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));\n  background-size: 2px 100%;\n  background-repeat: no-repeat;\n  background-position: center center;\n}\n\n/* Parallel-specific style estimator block */\n\n#sk-container-id-1 div.sk-parallel-item::after {\n  content: \"\";\n  width: 100%;\n  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);\n  flex-grow: 1;\n}\n\n#sk-container-id-1 div.sk-parallel {\n  display: flex;\n  align-items: stretch;\n  justify-content: center;\n  background-color: var(--sklearn-color-background);\n  position: relative;\n}\n\n#sk-container-id-1 div.sk-parallel-item {\n  display: flex;\n  flex-direction: column;\n}\n\n#sk-container-id-1 div.sk-parallel-item:first-child::after {\n  align-self: flex-end;\n  width: 50%;\n}\n\n#sk-container-id-1 div.sk-parallel-item:last-child::after {\n  align-self: flex-start;\n  width: 50%;\n}\n\n#sk-container-id-1 div.sk-parallel-item:only-child::after {\n  width: 0;\n}\n\n/* Serial-specific style estimator block */\n\n#sk-container-id-1 div.sk-serial {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  background-color: var(--sklearn-color-background);\n  padding-right: 1em;\n  padding-left: 1em;\n}\n\n\n/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is\nclickable and can be expanded/collapsed.\n- Pipeline and ColumnTransformer use this feature and define the default style\n- Estimators will overwrite some part of the style using the `sk-estimator` class\n*/\n\n/* Pipeline and ColumnTransformer style (default) */\n\n#sk-container-id-1 div.sk-toggleable {\n  /* Default theme specific background. It is overwritten whether we have a\n  specific estimator or a Pipeline/ColumnTransformer */\n  background-color: var(--sklearn-color-background);\n}\n\n/* Toggleable label */\n#sk-container-id-1 label.sk-toggleable__label {\n  cursor: pointer;\n  display: flex;\n  width: 100%;\n  margin-bottom: 0;\n  padding: 0.5em;\n  box-sizing: border-box;\n  text-align: center;\n  align-items: start;\n  justify-content: space-between;\n  gap: 0.5em;\n}\n\n#sk-container-id-1 label.sk-toggleable__label .caption {\n  font-size: 0.6rem;\n  font-weight: lighter;\n  color: var(--sklearn-color-text-muted);\n}\n\n#sk-container-id-1 label.sk-toggleable__label-arrow:before {\n  /* Arrow on the left of the label */\n  content: \"▸\";\n  float: left;\n  margin-right: 0.25em;\n  color: var(--sklearn-color-icon);\n}\n\n#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {\n  color: var(--sklearn-color-text);\n}\n\n/* Toggleable content - dropdown */\n\n#sk-container-id-1 div.sk-toggleable__content {\n  display: none;\n  text-align: left;\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-1 div.sk-toggleable__content.fitted {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n#sk-container-id-1 div.sk-toggleable__content pre {\n  margin: 0.2em;\n  border-radius: 0.25em;\n  color: var(--sklearn-color-text);\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-1 div.sk-toggleable__content.fitted pre {\n  /* unfitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {\n  /* Expand drop-down */\n  display: block;\n  width: 100%;\n  overflow: visible;\n}\n\n#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {\n  content: \"▾\";\n}\n\n/* Pipeline/ColumnTransformer-specific style */\n\n#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Estimator-specific style */\n\n/* Colorize estimator box */\n#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n#sk-container-id-1 div.sk-label label.sk-toggleable__label,\n#sk-container-id-1 div.sk-label label {\n  /* The background is the default theme color */\n  color: var(--sklearn-color-text-on-default-background);\n}\n\n/* On hover, darken the color of the background */\n#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n/* Label box, darken color on hover, fitted */\n#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Estimator label */\n\n#sk-container-id-1 div.sk-label label {\n  font-family: monospace;\n  font-weight: bold;\n  display: inline-block;\n  line-height: 1.2em;\n}\n\n#sk-container-id-1 div.sk-label-container {\n  text-align: center;\n}\n\n/* Estimator-specific */\n#sk-container-id-1 div.sk-estimator {\n  font-family: monospace;\n  border: 1px dotted var(--sklearn-color-border-box);\n  border-radius: 0.25em;\n  box-sizing: border-box;\n  margin-bottom: 0.5em;\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-1 div.sk-estimator.fitted {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n/* on hover */\n#sk-container-id-1 div.sk-estimator:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-1 div.sk-estimator.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Specification for estimator info (e.g. \"i\" and \"?\") */\n\n/* Common style for \"i\" and \"?\" */\n\n.sk-estimator-doc-link,\na:link.sk-estimator-doc-link,\na:visited.sk-estimator-doc-link {\n  float: right;\n  font-size: smaller;\n  line-height: 1em;\n  font-family: monospace;\n  background-color: var(--sklearn-color-background);\n  border-radius: 1em;\n  height: 1em;\n  width: 1em;\n  text-decoration: none !important;\n  margin-left: 0.5em;\n  text-align: center;\n  /* unfitted */\n  border: var(--sklearn-color-unfitted-level-1) 1pt solid;\n  color: var(--sklearn-color-unfitted-level-1);\n}\n\n.sk-estimator-doc-link.fitted,\na:link.sk-estimator-doc-link.fitted,\na:visited.sk-estimator-doc-link.fitted {\n  /* fitted */\n  border: var(--sklearn-color-fitted-level-1) 1pt solid;\n  color: var(--sklearn-color-fitted-level-1);\n}\n\n/* On hover */\ndiv.sk-estimator:hover .sk-estimator-doc-link:hover,\n.sk-estimator-doc-link:hover,\ndiv.sk-label-container:hover .sk-estimator-doc-link:hover,\n.sk-estimator-doc-link:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\ndiv.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,\n.sk-estimator-doc-link.fitted:hover,\ndiv.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,\n.sk-estimator-doc-link.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\n/* Span, style for the box shown on hovering the info icon */\n.sk-estimator-doc-link span {\n  display: none;\n  z-index: 9999;\n  position: relative;\n  font-weight: normal;\n  right: .2ex;\n  padding: .5ex;\n  margin: .5ex;\n  width: min-content;\n  min-width: 20ex;\n  max-width: 50ex;\n  color: var(--sklearn-color-text);\n  box-shadow: 2pt 2pt 4pt #999;\n  /* unfitted */\n  background: var(--sklearn-color-unfitted-level-0);\n  border: .5pt solid var(--sklearn-color-unfitted-level-3);\n}\n\n.sk-estimator-doc-link.fitted span {\n  /* fitted */\n  background: var(--sklearn-color-fitted-level-0);\n  border: var(--sklearn-color-fitted-level-3);\n}\n\n.sk-estimator-doc-link:hover span {\n  display: block;\n}\n\n/* \"?\"-specific style due to the `<a>` HTML tag */\n\n#sk-container-id-1 a.estimator_doc_link {\n  float: right;\n  font-size: 1rem;\n  line-height: 1em;\n  font-family: monospace;\n  background-color: var(--sklearn-color-background);\n  border-radius: 1rem;\n  height: 1rem;\n  width: 1rem;\n  text-decoration: none;\n  /* unfitted */\n  color: var(--sklearn-color-unfitted-level-1);\n  border: var(--sklearn-color-unfitted-level-1) 1pt solid;\n}\n\n#sk-container-id-1 a.estimator_doc_link.fitted {\n  /* fitted */\n  border: var(--sklearn-color-fitted-level-1) 1pt solid;\n  color: var(--sklearn-color-fitted-level-1);\n}\n\n/* On hover */\n#sk-container-id-1 a.estimator_doc_link:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\n#sk-container-id-1 a.estimator_doc_link.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-3);\n}\n\n.estimator-table summary {\n    padding: .5rem;\n    font-family: monospace;\n    cursor: pointer;\n}\n\n.estimator-table details[open] {\n    padding-left: 0.1rem;\n    padding-right: 0.1rem;\n    padding-bottom: 0.3rem;\n}\n\n.estimator-table .parameters-table {\n    margin-left: auto !important;\n    margin-right: auto !important;\n}\n\n.estimator-table .parameters-table tr:nth-child(odd) {\n    background-color: #fff;\n}\n\n.estimator-table .parameters-table tr:nth-child(even) {\n    background-color: #f6f6f6;\n}\n\n.estimator-table .parameters-table tr:hover {\n    background-color: #e0e0e0;\n}\n\n.estimator-table table td {\n    border: 1px solid rgba(106, 105, 104, 0.232);\n}\n\n.user-set td {\n    color:rgb(255, 94, 0);\n    text-align: left;\n}\n\n.user-set td.value pre {\n    color:rgb(255, 94, 0) !important;\n    background-color: transparent !important;\n}\n\n.default td {\n    color: black;\n    text-align: left;\n}\n\n.user-set td i,\n.default td i {\n    color: black;\n}\n\n.copy-paste-icon {\n    background-image: url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NDggNTEyIj48IS0tIUZvbnQgQXdlc29tZSBGcmVlIDYuNy4yIGJ5IEBmb250YXdlc29tZSAtIGh0dHBzOi8vZm9udGF3ZXNvbWUuY29tIExpY2Vuc2UgLSBodHRwczovL2ZvbnRhd2Vzb21lLmNvbS9saWNlbnNlL2ZyZWUgQ29weXJpZ2h0IDIwMjUgRm9udGljb25zLCBJbmMuLS0+PHBhdGggZD0iTTIwOCAwTDMzMi4xIDBjMTIuNyAwIDI0LjkgNS4xIDMzLjkgMTQuMWw2Ny45IDY3LjljOSA5IDE0LjEgMjEuMiAxNC4xIDMzLjlMNDQ4IDMzNmMwIDI2LjUtMjEuNSA0OC00OCA0OGwtMTkyIDBjLTI2LjUgMC00OC0yMS41LTQ4LTQ4bDAtMjg4YzAtMjYuNSAyMS41LTQ4IDQ4LTQ4ek00OCAxMjhsODAgMCAwIDY0LTY0IDAgMCAyNTYgMTkyIDAgMC0zMiA2NCAwIDAgNDhjMCAyNi41LTIxLjUgNDgtNDggNDhMNDggNTEyYy0yNi41IDAtNDgtMjEuNS00OC00OEwwIDE3NmMwLTI2LjUgMjEuNS00OCA0OC00OHoiLz48L3N2Zz4=);\n    background-repeat: no-repeat;\n    background-size: 14px 14px;\n    background-position: 0;\n    display: inline-block;\n    width: 14px;\n    height: 14px;\n    cursor: pointer;\n}\n</style><body><div id=\"sk-container-id-1\" class=\"sk-top-container\"><div class=\"sk-text-repr-fallback\"><pre>LogisticRegression(max_iter=1000)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class=\"sk-container\" hidden><div class=\"sk-item\"><div class=\"sk-estimator fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-1\" type=\"checkbox\" checked><label for=\"sk-estimator-id-1\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>LogisticRegression</div></div><div><a class=\"sk-estimator-doc-link fitted\" rel=\"noreferrer\" target=\"_blank\" href=\"https://scikit-learn.org/1.7/modules/generated/sklearn.linear_model.LogisticRegression.html\">?<span>Documentation for LogisticRegression</span></a><span class=\"sk-estimator-doc-link fitted\">i<span>Fitted</span></span></div></label><div class=\"sk-toggleable__content fitted\" data-param-prefix=\"\">\n        <div class=\"estimator-table\">\n            <details>\n                <summary>Parameters</summary>\n                <table class=\"parameters-table\">\n                  <tbody>\n                    \n        <tr class=\"default\">\n            <td><i class=\"copy-paste-icon\"\n                 onclick=\"copyToClipboard('penalty',\n                          this.parentElement.nextElementSibling)\"\n            ></i></td>\n            <td class=\"param\">penalty&nbsp;</td>\n            <td class=\"value\">&#x27;l2&#x27;</td>\n        </tr>\n    \n\n        <tr class=\"default\">\n            <td><i class=\"copy-paste-icon\"\n                 onclick=\"copyToClipboard('dual',\n                          this.parentElement.nextElementSibling)\"\n            ></i></td>\n            <td class=\"param\">dual&nbsp;</td>\n            <td class=\"value\">False</td>\n        </tr>\n    \n\n        <tr class=\"default\">\n            <td><i class=\"copy-paste-icon\"\n                 onclick=\"copyToClipboard('tol',\n                          this.parentElement.nextElementSibling)\"\n            ></i></td>\n            <td class=\"param\">tol&nbsp;</td>\n            <td class=\"value\">0.0001</td>\n        </tr>\n    \n\n        <tr class=\"default\">\n            <td><i class=\"copy-paste-icon\"\n                 onclick=\"copyToClipboard('C',\n                          this.parentElement.nextElementSibling)\"\n            ></i></td>\n            <td class=\"param\">C&nbsp;</td>\n            <td class=\"value\">1.0</td>\n        </tr>\n    \n\n        <tr class=\"default\">\n            <td><i class=\"copy-paste-icon\"\n                 onclick=\"copyToClipboard('fit_intercept',\n                          this.parentElement.nextElementSibling)\"\n            ></i></td>\n            <td class=\"param\">fit_intercept&nbsp;</td>\n            <td class=\"value\">True</td>\n        </tr>\n    \n\n        <tr class=\"default\">\n            <td><i class=\"copy-paste-icon\"\n                 onclick=\"copyToClipboard('intercept_scaling',\n                          this.parentElement.nextElementSibling)\"\n            ></i></td>\n            <td class=\"param\">intercept_scaling&nbsp;</td>\n            <td class=\"value\">1</td>\n        </tr>\n    \n\n        <tr class=\"default\">\n            <td><i class=\"copy-paste-icon\"\n                 onclick=\"copyToClipboard('class_weight',\n                          this.parentElement.nextElementSibling)\"\n            ></i></td>\n            <td class=\"param\">class_weight&nbsp;</td>\n            <td class=\"value\">None</td>\n        </tr>\n    \n\n        <tr class=\"default\">\n            <td><i class=\"copy-paste-icon\"\n                 onclick=\"copyToClipboard('random_state',\n                          this.parentElement.nextElementSibling)\"\n            ></i></td>\n            <td class=\"param\">random_state&nbsp;</td>\n            <td class=\"value\">None</td>\n        </tr>\n    \n\n        <tr class=\"default\">\n            <td><i class=\"copy-paste-icon\"\n                 onclick=\"copyToClipboard('solver',\n                          this.parentElement.nextElementSibling)\"\n            ></i></td>\n            <td class=\"param\">solver&nbsp;</td>\n            <td class=\"value\">&#x27;lbfgs&#x27;</td>\n        </tr>\n    \n\n        <tr class=\"user-set\">\n            <td><i class=\"copy-paste-icon\"\n                 onclick=\"copyToClipboard('max_iter',\n                          this.parentElement.nextElementSibling)\"\n            ></i></td>\n            <td class=\"param\">max_iter&nbsp;</td>\n            <td class=\"value\">1000</td>\n        </tr>\n    \n\n        <tr class=\"default\">\n            <td><i class=\"copy-paste-icon\"\n                 onclick=\"copyToClipboard('multi_class',\n                          this.parentElement.nextElementSibling)\"\n            ></i></td>\n            <td class=\"param\">multi_class&nbsp;</td>\n            <td class=\"value\">&#x27;deprecated&#x27;</td>\n        </tr>\n    \n\n        <tr class=\"default\">\n            <td><i class=\"copy-paste-icon\"\n                 onclick=\"copyToClipboard('verbose',\n                          this.parentElement.nextElementSibling)\"\n            ></i></td>\n            <td class=\"param\">verbose&nbsp;</td>\n            <td class=\"value\">0</td>\n        </tr>\n    \n\n        <tr class=\"default\">\n            <td><i class=\"copy-paste-icon\"\n                 onclick=\"copyToClipboard('warm_start',\n                          this.parentElement.nextElementSibling)\"\n            ></i></td>\n            <td class=\"param\">warm_start&nbsp;</td>\n            <td class=\"value\">False</td>\n        </tr>\n    \n\n        <tr class=\"default\">\n            <td><i class=\"copy-paste-icon\"\n                 onclick=\"copyToClipboard('n_jobs',\n                          this.parentElement.nextElementSibling)\"\n            ></i></td>\n            <td class=\"param\">n_jobs&nbsp;</td>\n            <td class=\"value\">None</td>\n        </tr>\n    \n\n        <tr class=\"default\">\n            <td><i class=\"copy-paste-icon\"\n                 onclick=\"copyToClipboard('l1_ratio',\n                          this.parentElement.nextElementSibling)\"\n            ></i></td>\n            <td class=\"param\">l1_ratio&nbsp;</td>\n            <td class=\"value\">None</td>\n        </tr>\n    \n                  </tbody>\n                </table>\n            </details>\n        </div>\n    </div></div></div></div></div><script>function copyToClipboard(text, element) {\n    // Get the parameter prefix from the closest toggleable content\n    const toggleableContent = element.closest('.sk-toggleable__content');\n    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';\n    const fullParamName = paramPrefix ? `${paramPrefix}${text}` : text;\n\n    const originalStyle = element.style;\n    const computedStyle = window.getComputedStyle(element);\n    const originalWidth = computedStyle.width;\n    const originalHTML = element.innerHTML.replace('Copied!', '');\n\n    navigator.clipboard.writeText(fullParamName)\n        .then(() => {\n            element.style.width = originalWidth;\n            element.style.color = 'green';\n            element.innerHTML = \"Copied!\";\n\n            setTimeout(() => {\n                element.innerHTML = originalHTML;\n                element.style = originalStyle;\n            }, 2000);\n        })\n        .catch(err => {\n            console.error('Failed to copy:', err);\n            element.style.color = 'red';\n            element.innerHTML = \"Failed!\";\n            setTimeout(() => {\n                element.innerHTML = originalHTML;\n                element.style = originalStyle;\n            }, 2000);\n        });\n    return false;\n}\n\ndocument.querySelectorAll('.fa-regular.fa-copy').forEach(function(element) {\n    const toggleableContent = element.closest('.sk-toggleable__content');\n    const paramPrefix = toggleableContent ? toggleableContent.dataset.paramPrefix : '';\n    const paramName = element.parentElement.nextElementSibling.textContent.trim();\n    const fullParamName = paramPrefix ? `${paramPrefix}${paramName}` : paramName;\n\n    element.setAttribute('title', fullParamName);\n});\n</script></body>\n```\n:::\n:::\n\n\n### Interpreting Coefficients\n\n::: {#coefficients .cell execution_count=6}\n``` {.python .cell-code}\nimport statsmodels.api as sm\n\n# use statsmodels for detailed output\nX = sm.add_constant(X)\nglm = sm.Logit(y, X).fit()\n\nprint(glm.summary().tables[1])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOptimization terminated successfully.\n         Current function value: 0.453242\n         Iterations 6\n==============================================================================\n                 coef    std err          z      P>|z|      [0.025      0.975]\n------------------------------------------------------------------------------\nconst          2.4698      0.525      4.707      0.000       1.442       3.498\nSex            2.5182      0.208     12.115      0.000       2.111       2.926\nAge           -0.0367      0.008     -4.780      0.000      -0.052      -0.022\nPclass        -1.2697      0.159     -8.005      0.000      -1.581      -0.959\nFare           0.0005      0.002      0.246      0.805      -0.004       0.005\n==============================================================================\n```\n:::\n:::\n\n\nCoefficients are on the log-odds scale. Positive coefficients increase the probability of survival, negative coefficients decrease it.\n\n- Sex (Female) - Coefficient = 2\\.52. Being female increases log-odds of survival. On the probability scale, women had much higher survival rates.\n- Age - Coefficient = \\-0\\.037. Younger passengers had slightly higher survival rates.\n- Pclass - Coefficient = \\-1\\.27. Higher class numbers (lower class) decrease survival probability.\n- Fare - Coefficient = 0\\.001. Higher fares (correlated with class) increase survival.\n\n### Converting Coefficients to Odds Ratios\n\nExponentiate coefficients to get **odds ratios**.\n\n::: {#odds-ratios .cell execution_count=7}\n``` {.python .cell-code}\nodds_ratios = np.exp(glm.params)\nconf_int = np.exp(glm.conf_int())\n\nresults_df = pd.DataFrame({\n    'Odds Ratio': odds_ratios,\n    '95% CI Lower': conf_int[0],\n    '95% CI Upper': conf_int[1]\n}).round(2)\n\nprint(\"\\nOdds Ratios:\")\nprint(results_df)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nOdds Ratios:\n        Odds Ratio  95% CI Lower  95% CI Upper\nconst        11.82          4.23         33.05\nSex          12.41          8.25         18.65\nAge           0.96          0.95          0.98\nPclass        0.28          0.21          0.38\nFare          1.00          1.00          1.00\n```\n:::\n:::\n\n\n- Sex - Being female multiplies the odds of survival by ~11. Women were much more likely to survive.\n- Age - Each year of age multiplies odds by ~0.97 (slight decrease).\n- Pclass - Each class decrease (e.g., 2nd to 3rd) multiplies odds by ~0.33.\n\n### Making Predictions\n\n::: {#predictions .cell execution_count=8}\n``` {.python .cell-code}\n# predict probabilities on test set\ny_pred_prob = clf.predict_proba(X_test)[:, 1]\ny_pred = clf.predict(X_test)\n\n# model performance\naccuracy = accuracy_score(y_test, y_pred)\nprint(f\"Test set accuracy: {accuracy:.1%}\")\n\n# confusion matrix\ncm = confusion_matrix(y_test, y_pred)\nprint(\"\\nConfusion Matrix:\")\nprint(pd.DataFrame(cm, \n                   columns=['Predicted: Died', 'Predicted: Survived'],\n                   index=['Actual: Died', 'Actual: Survived']))\n\n# classification report\nprint(\"\\nClassification Report:\")\nprint(classification_report(y_test, y_pred, target_names=['Died', 'Survived']))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTest set accuracy: 75.5%\n\nConfusion Matrix:\n                  Predicted: Died  Predicted: Survived\nActual: Died                   68                   19\nActual: Survived               16                   40\n\nClassification Report:\n              precision    recall  f1-score   support\n\n        Died       0.81      0.78      0.80        87\n    Survived       0.68      0.71      0.70        56\n\n    accuracy                           0.76       143\n   macro avg       0.74      0.75      0.75       143\nweighted avg       0.76      0.76      0.76       143\n\n```\n:::\n:::\n\n\nThe model correctly classifies ~76% of passengers. It performs better at predicting deaths than survivals, likely because more passengers died overall.\n\n### Visualising Predictions\n\n::: {#cell-prediction-plot .cell execution_count=9}\n``` {.python .cell-code}\n# create a grid of ages and predict survival probability for male/female passengers\nage_range = np.linspace(0, 80, 100)\n\n# predictions for male, 3rd class passengers\nX_male = pd.DataFrame({\n    'Sex': 0,\n    'Age': age_range,\n    'Pclass': 3,\n    'Fare': df['Fare'].median()\n})\n\n# predictions for female, 3rd class passengers\nX_female = pd.DataFrame({\n    'Sex': 1,\n    'Age': age_range,\n    'Pclass': 3,\n    'Fare': df['Fare'].median()\n})\n\nprob_male = clf.predict_proba(X_male)[:, 1]\nprob_female = clf.predict_proba(X_female)[:, 1]\n\nfig, ax = plt.subplots(figsize=(10, 6))\nsns.lineplot(x=age_range, y=prob_male, color='#005EB8', linewidth=2, \n             label='Male, 3rd Class', ax=ax)\nsns.lineplot(x=age_range, y=prob_female, color='#ED8B00', linewidth=2,\n             label='Female, 3rd Class', ax=ax)\nax.set_xlabel('Age')\nax.set_ylabel('Probability of Survival')\nax.set_title('Predicted Survival Probability by Age and Sex (3rd Class)')\nax.set_ylim(0, 1)\nax.legend()\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/prediction-plot-output-1.png){#prediction-plot}\n:::\n:::\n\n\nFemale passengers had much higher predicted survival probabilities across all ages. Younger passengers (especially children) had higher survival rates, consistent with \"women and children first\".\n\n## Other Extensions of Linear Regression\n\nLogistic regression is just one example of adapting the linear framework to non-linear data, but there are many ways this framework can be extended.\n\n### Poisson Regression for Count Data\n\nWhen outcomes are counts (number of events, visits, occurrences), Poisson regression uses a log link.\n\n<details>\n  <summary> Model Formula (Click to Expand)</summary> \n$$\n\\log(\\text{E}[Y]) = \\beta_0 + \\beta_1X\n$$\n\nTransform back to get expected count: $\\text{E}[Y] = e^{\\beta_0 + \\beta_1X}$. Predictions are always positive, matching count data.\n\n</details>\n\nExample use cases - Number of hospital admissions, customer complaints, goals scored.\n\n### Generalised Additive Models (GAMs)\n\nGAMs fit smooth, flexible curves instead of straight lines.\n\n<details>\n  <summary> Model Formula (Click to Expand)</summary> \n\n$$\nY = \\beta_0 + f_1(X_1) + f_2(X_2) + \\epsilon\n$$\n\nEach $f_i(X_i)$ is a smooth function that adapts to the data. GAMs capture complex non-linear patterns (U-shapes, wiggles) while remaining interpretable.\n\n</details>\n\nExample use cases - Temperature effects on sales, age-related health trends, non-linear dose-response relationships.\n\nPython implementation uses `pygam`:\n\n```python\nfrom pygam import GAM, s\n\n# fit a GAM with smooth functions\ngam = GAM(s(0) + s(1))\ngam.fit(X, y)\n```\n\n### Multilevel Models\n\nWhen data has hierarchical structure (students in schools, patients in hospitals, repeated measures on individuals), multilevel models account for grouping.\n\n<details>\n  <summary> Model Formula (Click to Expand)</summary> \n$$\nY_{ij} = \\beta_0 + u_j + \\beta_1X_{ij} + \\epsilon_{ij}\n$$\n\n- $u_j$ is a group-specific effect (random intercept).\n- Groups can have different baselines but share information.\n\n</details>\n\nExample use cases - Educational data (students in schools), clinical trials (patients in sites), longitudinal data (repeated measures on individuals).\n\nPython implementation uses `statsmodels` or `pymer4`:\n\n```python\nimport statsmodels.formula.api as smf\n\n# fit a multilevel model\nmlm = smf.mixedlm(\"y ~ x\", data=df, groups=df[\"group_id\"])\nresult = mlm.fit()\n```\n\n### Survival Analysis\n\nWhen modelling time until an event (death, failure, recovery), use survival models like Cox proportional hazards regression. These account for censoring (observations where the event hasn't occurred yet).\n\nExample use cases - Patient survival times, equipment failure, customer churn.\n\n## Why This Matters\n\nAll these models share the same foundation: linear regression. Once you understand fitting a line to data, you can:\n\n- Use link functions for constrained outcomes (binary, counts, proportions)\n- Fit flexible curves with GAMs\n- Account for hierarchy with multilevel models\n- Model time-to-event data with survival analysis\n\nThe linear framework is incredibly versatile. It's not just for linear relationships.\n\n## Summary\n\n- Real data often violates linear regression assumptions\n- Link functions transform data so linear models work\n- Logistic regression (logit link) handles binary outcomes\n- Other GLMs (Poisson, etc.) handle counts and constrained data\n- Extensions like GAMs and multilevel models add flexibility\n- The linear framework adapts to almost any problem\n\nLinear regression isn't just a starting point. It's a foundation you can build on for almost any modelling task.\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}
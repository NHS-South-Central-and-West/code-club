<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Walkthrough of fingertips_py</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-3f7093b32262dae94df6af3cc5865a54.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../images/code_club_text.png" alt="" class="navbar-logo light-content">
    <img src="../../images/code_club_text.png" alt="" class="navbar-logo dark-content">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-sessions" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Sessions</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-sessions">    
        <li>
    <a class="dropdown-item" href="../../sessions/schedule.html">
 <span class="dropdown-text">Essential Skills</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../intermediate-skills-sessions/intermediate_skills_schedule.html">
 <span class="dropdown-text">Intermediate Skills</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-resources" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Resources</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-resources">    
        <li>
    <a class="dropdown-item" href="../../resources/glossary.html">
 <span class="dropdown-text">Glossary</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/NHS-South-Central-and-West/code-club" title="" class="quarto-navigation-tool px-1" aria-label="GitHub"><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#documentation" id="toc-documentation" class="nav-link active" data-scroll-target="#documentation">Documentation</a></li>
  <li><a href="#installation" id="toc-installation" class="nav-link" data-scroll-target="#installation">Installation</a>
  <ul class="collapse">
  <li><a href="#uv" id="toc-uv" class="nav-link" data-scroll-target="#uv">uv</a></li>
  <li><a href="#pip" id="toc-pip" class="nav-link" data-scroll-target="#pip">pip</a></li>
  </ul></li>
  <li><a href="#exploring-package-functionality" id="toc-exploring-package-functionality" class="nav-link" data-scroll-target="#exploring-package-functionality">Exploring package functionality</a>
  <ul class="collapse">
  <li><a href="#importing-the-package" id="toc-importing-the-package" class="nav-link" data-scroll-target="#importing-the-package">Importing the package</a></li>
  <li><a href="#get-profile-ids-by-profile-name" id="toc-get-profile-ids-by-profile-name" class="nav-link" data-scroll-target="#get-profile-ids-by-profile-name">Get profile IDs by profile name</a></li>
  <li><a href="#get-profile-metadata-as-a-dataframe" id="toc-get-profile-metadata-as-a-dataframe" class="nav-link" data-scroll-target="#get-profile-metadata-as-a-dataframe">Get profile metadata as a dataframe</a></li>
  <li><a href="#get-metadata-by-indicator-id" id="toc-get-metadata-by-indicator-id" class="nav-link" data-scroll-target="#get-metadata-by-indicator-id">Get metadata by indicator ID</a></li>
  <li><a href="#get-all-area-types" id="toc-get-all-area-types" class="nav-link" data-scroll-target="#get-all-area-types">Get all area types</a></li>
  <li><a href="#get-all-area-types-available-for-a-particular-profile" id="toc-get-all-area-types-available-for-a-particular-profile" class="nav-link" data-scroll-target="#get-all-area-types-available-for-a-particular-profile">Get all area types available for a particular profile</a></li>
  <li><a href="#get-all-data-for-indicators" id="toc-get-all-data-for-indicators" class="nav-link" data-scroll-target="#get-all-data-for-indicators">Get all data for indicators</a></li>
  <li><a href="#get-data-at-all-available-geographies-for-a-particular-indicator" id="toc-get-data-at-all-available-geographies-for-a-particular-indicator" class="nav-link" data-scroll-target="#get-data-at-all-available-geographies-for-a-particular-indicator">Get data at all available geographies for a particular indicator</a></li>
  <li><a href="#lets-put-all-this-together-and-visualise-it-on-a-map" id="toc-lets-put-all-this-together-and-visualise-it-on-a-map" class="nav-link" data-scroll-target="#lets-put-all-this-together-and-visualise-it-on-a-map">Let’s put all this together and visualise it on a map</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="fingertips_py.ipynb" download="fingertips_py.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Walkthrough of <code>fingertips_py</code></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In conjunction with the tutorial on <a href="../../intermediate-skills-sessions/18-webscraping-apis/index.html">webscraping and APIs</a>, below is a walkthrough of the <code>fingertips_py</code> package maintained by the Department of Health and Social Care, which simplifies importing data via the Fingertips API.</p>
<section id="documentation" class="level2">
<h2 class="anchored" data-anchor-id="documentation">Documentation</h2>
<p><a href="https://fingertips.phe.org.uk/profiles">Fingertips Public Health Profiles (public-facing source of the data)</a></p>
<p><a href="https://fingertips-py.readthedocs.io/en/latest/">Fingertips Python API package (fingertips_py) documentation</a></p>
<p><a href="https://github.com/DataS-DHSC/fingertips_py">Package repository</a></p>
</section>
<section id="installation" class="level2">
<h2 class="anchored" data-anchor-id="installation">Installation</h2>
<p>For more information, see the fingertips_py documentation.</p>
<p>Code Club recommends using the uv package management software, but if you do need to use pip, the relevant installation instructions are below.</p>
<section id="uv" class="level3">
<h3 class="anchored" data-anchor-id="uv">uv</h3>
<p>To install using uv, enter the following in the terminal:</p>
<pre><code>uv add fingertips_py</code></pre>
</section>
<section id="pip" class="level3">
<h3 class="anchored" data-anchor-id="pip">pip</h3>
<p>To install using pip, activate your environment and enter the following in the terminal:</p>
<pre><code>python -m pip install fingertips_py</code></pre>
</section>
</section>
<section id="exploring-package-functionality" class="level2">
<h2 class="anchored" data-anchor-id="exploring-package-functionality">Exploring package functionality</h2>
<p>Let’s have a look at the various methods in the package that allow us to import different levels of the dataset and the metadata.</p>
<section id="importing-the-package" class="level3">
<h3 class="anchored" data-anchor-id="importing-the-package">Importing the package</h3>
<p>We will also use <code>pandas</code> for presenting the imported data in a dataframe.</p>
<div id="import-packages" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> fingertips_py <span class="im">as</span> ftp</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="get-profile-ids-by-profile-name" class="level3">
<h3 class="anchored" data-anchor-id="get-profile-ids-by-profile-name">Get profile IDs by profile name</h3>
<p>The profile IDs can be used to refer to different “profiles” on Fingertips. That is to say, different aspects of public health such as levels of diabetes, cardiovascular disease, or dementia in the country.</p>
<div id="get-profile-ids" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cancer profile ID</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>cancer_profile_md <span class="op">=</span> ftp.metadata.get_profile_by_name(<span class="st">'cancer services'</span>) <span class="co"># creates a dictionary of metadata. Profile names are not case sensitive.</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>cancer_profile_id <span class="op">=</span> cancer_profile_md[<span class="st">'Id'</span>] <span class="co"># access the profile ID in the metadata dictionary</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Wider Determinants of Health profile ID</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>wdoh_profile_md <span class="op">=</span> ftp.metadata.get_profile_by_name(<span class="st">'wider determinants of health'</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>wdoh_profile_id <span class="op">=</span> wdoh_profile_md[<span class="st">'Id'</span>]</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Return the IDs</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Cancer profile ID: </span><span class="sc">{</span>cancer_profile_id<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Wider Determinants of Health profile ID: </span><span class="sc">{</span>wdoh_profile_id<span class="sc">}</span><span class="ss">'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cancer profile ID: 92
Wider Determinants of Health profile ID: 130</code></pre>
</div>
</div>
</section>
<section id="get-profile-metadata-as-a-dataframe" class="level3">
<h3 class="anchored" data-anchor-id="get-profile-metadata-as-a-dataframe">Get profile metadata as a dataframe</h3>
<p>Inspecting the metadata gives you a lot of information about a given profile, such as metric sources, definition, and polarity.</p>
<div id="cell-wdoh-metadata" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>wdoh_md_df <span class="op">=</span> ftp.metadata.get_metadata_for_profile_as_dataframe(wdoh_profile_id)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>wdoh_md_df.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="wdoh-metadata" class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Indicator ID</th>
<th data-quarto-table-cell-role="th">Indicator</th>
<th data-quarto-table-cell-role="th">Indicator number</th>
<th data-quarto-table-cell-role="th">Rationale</th>
<th data-quarto-table-cell-role="th">Specific rationale</th>
<th data-quarto-table-cell-role="th">Definition</th>
<th data-quarto-table-cell-role="th">Data source</th>
<th data-quarto-table-cell-role="th">Indicator source</th>
<th data-quarto-table-cell-role="th">Definition of numerator</th>
<th data-quarto-table-cell-role="th">Source of numerator</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Data re-use</th>
<th data-quarto-table-cell-role="th">Links</th>
<th data-quarto-table-cell-role="th">Indicator Content</th>
<th data-quarto-table-cell-role="th">Simple Name</th>
<th data-quarto-table-cell-role="th">Simple Definition</th>
<th data-quarto-table-cell-role="th">Unit</th>
<th data-quarto-table-cell-role="th">Value type</th>
<th data-quarto-table-cell-role="th">Year type</th>
<th data-quarto-table-cell-role="th">Polarity</th>
<th data-quarto-table-cell-role="th">Date updated</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>11401</td>
<td>The rate of complaints about noise</td>
<td>B14a</td>
<td>The Government's policy on noise is set out in...</td>
<td>NaN</td>
<td>Number of complaints per year per local author...</td>
<td>OHID, in collaboration with Chartered Institut...</td>
<td>Data on noise complaints provided by Chartered...</td>
<td>Number of complaints about noise.</td>
<td>Chartered Institute of Environmental Health (C...</td>
<td>...</td>
<td>NaN</td>
<td>http://www.cieh.org/</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>per 1,000</td>
<td>Crude rate</td>
<td>Financial</td>
<td>RAG - Low is good</td>
<td>11/04/2025</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>93754</td>
<td>Killed and seriously injured casualties on Eng...</td>
<td>B10</td>
<td>Motor vehicle traffic accidents are a major ca...</td>
<td>NaN</td>
<td>Number of people reported killed or seriously ...</td>
<td>OHID, based on Department for Transport data</td>
<td>NaN</td>
<td>The number of people of all ages killed or ser...</td>
<td>Department for Transport (DfT), Road accidents...</td>
<td>...</td>
<td>Killed and seriously injured data are National...</td>
<td>&lt;span style="color: #0b0c0c; font-family: GDS ...</td>
<td>NaN</td>
<td>People killed or seriously injured on roads</td>
<td>Rate of people reported killed or seriously in...</td>
<td>per billion vehicle miles</td>
<td>Crude rate</td>
<td>Calendar</td>
<td>RAG - Low is good</td>
<td>22/10/2025</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>93074</td>
<td>Access to Healthy Assets &amp; Hazards Index</td>
<td>NaN</td>
<td>The Access to Healthy Assets and Hazards (AHAH...</td>
<td>NaN</td>
<td>Percentage of the population who live in LSOAs...</td>
<td>Consumer Data Research Centre</td>
<td>The overall index collates data from a variety...</td>
<td>Total population residing in Lower Super Outpu...</td>
<td>Consumer Data Research Centre (CDRC), Access t...</td>
<td>...</td>
<td>NaN</td>
<td>https://data.cdrc.ac.uk/dataset/access-healthy...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>%</td>
<td>Proportion</td>
<td>Calendar</td>
<td>RAG - Low is good</td>
<td>03/09/2024</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>90357</td>
<td>The percentage of the population exposed to ro...</td>
<td>B14b</td>
<td>There are a number of direct and indirect link...</td>
<td>NaN</td>
<td>Noise exposure determined by strategic noise m...</td>
<td>OHID, based on Department for Environment, Foo...</td>
<td>NaN</td>
<td>Noise exposure determined by strategic noise m...</td>
<td>Department for Environment, Food and Rural Aff...</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>%</td>
<td>Proportion</td>
<td>Calendar</td>
<td>RAG - Low is good</td>
<td>23/01/2025</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>94124</td>
<td>Fast food outlets per 100,000 population</td>
<td>NaN</td>
<td>&lt;p class="MsoNormal" style="margin-bottom: 0cm...</td>
<td>NaN</td>
<td>&lt;p class="MsoNormal" style="margin-bottom: 0cm...</td>
<td>OHID, based on Food Standards Agency data</td>
<td>NaN</td>
<td>&lt;span style="line-height: 107%; mso-fareast-fo...</td>
<td>Food Standards Agency (FSA), Food Hygiene Rati...</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>per 100,000</td>
<td>Crude rate</td>
<td>Calendar</td>
<td>RAG - Low is good</td>
<td>24/01/2025</td>
</tr>
</tbody>
</table>

<p>5 rows × 32 columns</p>
</div>
</div>
</div>
</section>
<section id="get-metadata-by-indicator-id" class="level3">
<h3 class="anchored" data-anchor-id="get-metadata-by-indicator-id">Get metadata by indicator ID</h3>
<div id="cell-fastfood-indicator" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>fast_food_md <span class="op">=</span> ftp.get_metadata_for_indicator_as_dataframe(<span class="dv">94124</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>fast_food_md</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="fastfood-indicator" class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Indicator ID</th>
<th data-quarto-table-cell-role="th">Indicator</th>
<th data-quarto-table-cell-role="th">Indicator number</th>
<th data-quarto-table-cell-role="th">Rationale</th>
<th data-quarto-table-cell-role="th">Specific rationale</th>
<th data-quarto-table-cell-role="th">Definition</th>
<th data-quarto-table-cell-role="th">Data source</th>
<th data-quarto-table-cell-role="th">Indicator source</th>
<th data-quarto-table-cell-role="th">Definition of numerator</th>
<th data-quarto-table-cell-role="th">Source of numerator</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Data re-use</th>
<th data-quarto-table-cell-role="th">Links</th>
<th data-quarto-table-cell-role="th">Indicator Content</th>
<th data-quarto-table-cell-role="th">Simple Name</th>
<th data-quarto-table-cell-role="th">Simple Definition</th>
<th data-quarto-table-cell-role="th">Unit</th>
<th data-quarto-table-cell-role="th">Value type</th>
<th data-quarto-table-cell-role="th">Year type</th>
<th data-quarto-table-cell-role="th">Polarity</th>
<th data-quarto-table-cell-role="th">Date updated</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>94124</td>
<td>Fast food outlets per 100,000 population</td>
<td>NaN</td>
<td>&lt;p class="MsoNormal" style="margin-bottom: 0cm...</td>
<td>NaN</td>
<td>&lt;p class="MsoNormal" style="margin-bottom: 0cm...</td>
<td>OHID, based on Food Standards Agency data</td>
<td>NaN</td>
<td>&lt;span style="line-height: 107%; mso-fareast-fo...</td>
<td>Food Standards Agency (FSA), Food Hygiene Rati...</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>per 100,000</td>
<td>Crude rate</td>
<td>Calendar</td>
<td>RAG - Low is good</td>
<td>24/01/2025</td>
</tr>
</tbody>
</table>

<p>1 rows × 32 columns</p>
</div>
</div>
</div>
</section>
<section id="get-all-area-types" class="level3">
<h3 class="anchored" data-anchor-id="get-all-area-types">Get all area types</h3>
<p>This can help you understand which geographical breakdowns are available via the API. The code below just returns the first 10 so that a large table doesn’t get displayed on this page, but there are many more. Worth looking into, if you are planning to make use of these metrics to support the narrative in a report you are working on.</p>
<div id="cell-all-areas" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># returns a nested dictionary, where the area ID is the key to a further dictionary of key:value pairs</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>all_areas_dict <span class="op">=</span> ftp.metadata.get_all_areas()</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># converts the nested dictionary to a DataFrame, where the outer key becomes the index</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>all_areas_df <span class="op">=</span> pd.DataFrame.from_dict(all_areas_dict, orient<span class="op">=</span><span class="st">'index'</span>) </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># reset the DataFrame to have the default indexing</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>all_areas_df <span class="op">=</span> all_areas_df.reset_index() </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the column labelled 'index' in the dictionary-to-DataFrame conversion</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>all_areas_df.rename(columns<span class="op">=</span>{<span class="st">'index'</span>:<span class="st">'Id'</span>}, inplace<span class="op">=</span><span class="va">True</span>) </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>all_areas_df.head(<span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="all-areas" class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Id</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Short</th>
<th data-quarto-table-cell-role="th">Class</th>
<th data-quarto-table-cell-role="th">Sequence</th>
<th data-quarto-table-cell-role="th">CanBeDisplayedOnMap</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>3</td>
<td>Middle Super Output Area</td>
<td>MSOA</td>
<td>None</td>
<td>0</td>
<td>True</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>6</td>
<td>Government Office Region (E12)</td>
<td>Regions (statistical)</td>
<td>None</td>
<td>0</td>
<td>True</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>7</td>
<td>General Practice</td>
<td>GPs</td>
<td>gp</td>
<td>0</td>
<td>True</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>8</td>
<td>Electoral Best Fit Wards (2024)</td>
<td>Electoral Wards (2024)</td>
<td>None</td>
<td>0</td>
<td>True</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>9</td>
<td>Census Merged Wards</td>
<td>Merged Wards</td>
<td>None</td>
<td>0</td>
<td>False</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">5</th>
<td>14</td>
<td>Acute Trust</td>
<td>Acute Trust</td>
<td>None</td>
<td>0</td>
<td>False</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>15</td>
<td>England</td>
<td>England</td>
<td>None</td>
<td>0</td>
<td>False</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">7</th>
<td>20</td>
<td>Mental Health Trust</td>
<td>Mental Health Trust</td>
<td>None</td>
<td>0</td>
<td>False</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">8</th>
<td>41</td>
<td>Ambulance Trust</td>
<td>Ambulance Trust</td>
<td>None</td>
<td>0</td>
<td>False</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">9</th>
<td>66</td>
<td>Sub-ICB, former CCGs</td>
<td>ICB sub-locations</td>
<td>None</td>
<td>2022</td>
<td>True</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="get-all-area-types-available-for-a-particular-profile" class="level3">
<h3 class="anchored" data-anchor-id="get-all-area-types-available-for-a-particular-profile">Get all area types available for a particular profile</h3>
<div id="cell-all-areas-profile" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>wdoh_areas <span class="op">=</span> ftp.metadata.get_area_types_for_profile(wdoh_profile_id)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>wdoh_areas_df <span class="op">=</span> pd.DataFrame.from_dict(wdoh_areas, orient<span class="op">=</span><span class="st">'index'</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>wdoh_areas_df.reset_index(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>wdoh_areas_df.drop(<span class="st">'index'</span>, axis<span class="op">=</span><span class="dv">1</span>,inplace<span class="op">=</span><span class="va">True</span>) <span class="co"># drop the column called 'index' following the dictionary-to-DataFrame conversion</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>wdoh_areas_df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="all-areas-profile" class="cell-output cell-output-display" data-execution_count="6">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Short</th>
<th data-quarto-table-cell-role="th">Class</th>
<th data-quarto-table-cell-role="th">CanBeDisplayedOnMap</th>
<th data-quarto-table-cell-role="th">Sequence</th>
<th data-quarto-table-cell-role="th">Id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>Government Office Region (E12)</td>
<td>Regions (statistical)</td>
<td>None</td>
<td>True</td>
<td>0</td>
<td>6</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>England</td>
<td>England</td>
<td>None</td>
<td>False</td>
<td>0</td>
<td>15</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>Lower tier local authorities (post 4/23)</td>
<td>Districts &amp; UAs (from Apr 2023)</td>
<td>ua-la-composite</td>
<td>True</td>
<td>2023</td>
<td>501</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>Upper tier local authorities (post 4/23)</td>
<td>Counties &amp; UAs (from Apr 2023)</td>
<td>ua-county-composite</td>
<td>True</td>
<td>2023</td>
<td>502</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="get-all-data-for-indicators" class="level3">
<h3 class="anchored" data-anchor-id="get-all-data-for-indicators">Get all data for indicators</h3>
<p>There seems to be an error within this function at time of writing since it constructs an invalid URL. It has been kept in this demonstration so that you can be made aware that this method may not work, unless it has been fixed.</p>
<p><code>ftp.retrieve_data.get_all_data_for_indicators</code></p>
<div id="get-all-error" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>wdoh_indicators_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    ftp.retrieve_data.get_all_data_for_indicators(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        [<span class="dv">11404</span>,<span class="dv">92772</span>],                  <span class="co"># two Wider Determinants of Health indicators</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>         <span class="dv">502</span>,                           <span class="co"># Area type = Upper tier local authorities</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>         <span class="dv">15</span>,                            <span class="co"># Parent area type =  England</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>         filter_by_area_codes<span class="op">=</span> <span class="va">None</span>,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>         is_test<span class="op">=</span> <span class="va">False</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>wdoh_indicators_df.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<section id="lets-try-this-one-instead" class="level4">
<h4 class="anchored" data-anchor-id="lets-try-this-one-instead">Let’s try this one instead</h4>
<p>This one does much the same thing, though slightly differently, while not causing an error.</p>
<p><code>fingertips_py.retrieve_data.get_data_by_indicator_ids</code></p>
<div id="cell-get-all-success" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>wdoh_indicators_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    ftp.retrieve_data.get_data_by_indicator_ids(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        [<span class="dv">11404</span>,<span class="dv">92772</span>],                          <span class="co"># two Wider Determinants of Health indicators</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>         <span class="dv">502</span>,                                   <span class="co"># Area type = Upper tier local authorities</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>         <span class="dv">15</span>,                                    <span class="co"># Parent area type =  England</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>         include_sortable_time_periods<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>         is_test<span class="op">=</span> <span class="va">False</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>wdoh_indicators_df.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="get-all-success" class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Indicator ID</th>
<th data-quarto-table-cell-role="th">Indicator Name</th>
<th data-quarto-table-cell-role="th">Parent Code</th>
<th data-quarto-table-cell-role="th">Parent Name</th>
<th data-quarto-table-cell-role="th">Area Code</th>
<th data-quarto-table-cell-role="th">Area Name</th>
<th data-quarto-table-cell-role="th">Area Type</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">Category Type</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Count</th>
<th data-quarto-table-cell-role="th">Denominator</th>
<th data-quarto-table-cell-role="th">Value note</th>
<th data-quarto-table-cell-role="th">Recent Trend</th>
<th data-quarto-table-cell-role="th">Compared to England value or percentiles</th>
<th data-quarto-table-cell-role="th">Compared to percentiles</th>
<th data-quarto-table-cell-role="th">Time period Sortable</th>
<th data-quarto-table-cell-role="th">New data</th>
<th data-quarto-table-cell-role="th">Compared to goal</th>
<th data-quarto-table-cell-role="th">Time period range</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>92772</td>
<td>Premises licensed to sell alcohol per square k...</td>
<td>NaN</td>
<td>NaN</td>
<td>E92000001</td>
<td>England</td>
<td>England</td>
<td>Not applicable</td>
<td>Not applicable</td>
<td>NaN</td>
<td>...</td>
<td>154487.0</td>
<td>130310.0136</td>
<td>Aggregated from all known lower geography values</td>
<td>NaN</td>
<td>Not compared</td>
<td>Not compared</td>
<td>20150000</td>
<td>NaN</td>
<td>NaN</td>
<td>1y</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>92772</td>
<td>Premises licensed to sell alcohol per square k...</td>
<td>E92000001</td>
<td>England</td>
<td>E92000001</td>
<td>England</td>
<td>England</td>
<td>Not applicable</td>
<td>Not applicable</td>
<td>NaN</td>
<td>...</td>
<td>154487.0</td>
<td>130310.0136</td>
<td>Aggregated from all known lower geography values</td>
<td>NaN</td>
<td>Similar</td>
<td>Not compared</td>
<td>20150000</td>
<td>NaN</td>
<td>NaN</td>
<td>1y</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>92772</td>
<td>Premises licensed to sell alcohol per square k...</td>
<td>E92000001</td>
<td>England</td>
<td>E06000001</td>
<td>Hartlepool</td>
<td>Counties &amp; UAs (from Apr 2023)</td>
<td>Not applicable</td>
<td>Not applicable</td>
<td>NaN</td>
<td>...</td>
<td>312.0</td>
<td>93.5595</td>
<td>NaN</td>
<td>NaN</td>
<td>Worse</td>
<td>Not compared</td>
<td>20150000</td>
<td>NaN</td>
<td>NaN</td>
<td>1y</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>92772</td>
<td>Premises licensed to sell alcohol per square k...</td>
<td>E92000001</td>
<td>England</td>
<td>E06000002</td>
<td>Middlesbrough</td>
<td>Counties &amp; UAs (from Apr 2023)</td>
<td>Not applicable</td>
<td>Not applicable</td>
<td>NaN</td>
<td>...</td>
<td>347.0</td>
<td>53.8888</td>
<td>NaN</td>
<td>NaN</td>
<td>Worse</td>
<td>Not compared</td>
<td>20150000</td>
<td>NaN</td>
<td>NaN</td>
<td>1y</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>92772</td>
<td>Premises licensed to sell alcohol per square k...</td>
<td>E92000001</td>
<td>England</td>
<td>E06000003</td>
<td>Redcar and Cleveland</td>
<td>Counties &amp; UAs (from Apr 2023)</td>
<td>Not applicable</td>
<td>Not applicable</td>
<td>NaN</td>
<td>...</td>
<td>361.0</td>
<td>244.8202</td>
<td>NaN</td>
<td>NaN</td>
<td>Worse</td>
<td>Not compared</td>
<td>20150000</td>
<td>NaN</td>
<td>NaN</td>
<td>1y</td>
</tr>
</tbody>
</table>

<p>5 rows × 27 columns</p>
</div>
</div>
</div>
</section>
</section>
<section id="get-data-at-all-available-geographies-for-a-particular-indicator" class="level3">
<h3 class="anchored" data-anchor-id="get-data-at-all-available-geographies-for-a-particular-indicator">Get data at all available geographies for a particular indicator</h3>
<div id="cell-get-all-at-all-geog" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>licensed_premises_all_geographies <span class="op">=</span> ftp.retrieve_data.get_data_for_indicator_at_all_available_geographies(<span class="dv">92772</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>licensed_premises_all_geographies.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="get-all-at-all-geog" class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Indicator ID</th>
<th data-quarto-table-cell-role="th">Indicator Name</th>
<th data-quarto-table-cell-role="th">Parent Code</th>
<th data-quarto-table-cell-role="th">Parent Name</th>
<th data-quarto-table-cell-role="th">Area Code</th>
<th data-quarto-table-cell-role="th">Area Name</th>
<th data-quarto-table-cell-role="th">Area Type</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">Category Type</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Count</th>
<th data-quarto-table-cell-role="th">Denominator</th>
<th data-quarto-table-cell-role="th">Value note</th>
<th data-quarto-table-cell-role="th">Recent Trend</th>
<th data-quarto-table-cell-role="th">Compared to England value or percentiles</th>
<th data-quarto-table-cell-role="th">Compared to percentiles</th>
<th data-quarto-table-cell-role="th">Time period Sortable</th>
<th data-quarto-table-cell-role="th">New data</th>
<th data-quarto-table-cell-role="th">Compared to goal</th>
<th data-quarto-table-cell-role="th">Time period range</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>92772</td>
<td>Premises licensed to sell alcohol per square k...</td>
<td>NaN</td>
<td>NaN</td>
<td>E92000001</td>
<td>England</td>
<td>England</td>
<td>Not applicable</td>
<td>Not applicable</td>
<td>NaN</td>
<td>...</td>
<td>154487.0</td>
<td>130310.0136</td>
<td>Aggregated from all known lower geography values</td>
<td>NaN</td>
<td>Not compared</td>
<td>Not compared</td>
<td>20150000</td>
<td>NaN</td>
<td>NaN</td>
<td>1y</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>92772</td>
<td>Premises licensed to sell alcohol per square k...</td>
<td>E92000001</td>
<td>England</td>
<td>E92000001</td>
<td>England</td>
<td>England</td>
<td>Not applicable</td>
<td>Not applicable</td>
<td>NaN</td>
<td>...</td>
<td>154487.0</td>
<td>130310.0136</td>
<td>Aggregated from all known lower geography values</td>
<td>NaN</td>
<td>Similar</td>
<td>Not compared</td>
<td>20150000</td>
<td>NaN</td>
<td>NaN</td>
<td>1y</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>92772</td>
<td>Premises licensed to sell alcohol per square k...</td>
<td>E92000001</td>
<td>England</td>
<td>E06000001</td>
<td>Hartlepool</td>
<td>Counties &amp; UAs (from Apr 2023)</td>
<td>Not applicable</td>
<td>Not applicable</td>
<td>NaN</td>
<td>...</td>
<td>312.0</td>
<td>93.5595</td>
<td>NaN</td>
<td>NaN</td>
<td>Worse</td>
<td>Not compared</td>
<td>20150000</td>
<td>NaN</td>
<td>NaN</td>
<td>1y</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>92772</td>
<td>Premises licensed to sell alcohol per square k...</td>
<td>E92000001</td>
<td>England</td>
<td>E06000002</td>
<td>Middlesbrough</td>
<td>Counties &amp; UAs (from Apr 2023)</td>
<td>Not applicable</td>
<td>Not applicable</td>
<td>NaN</td>
<td>...</td>
<td>347.0</td>
<td>53.8888</td>
<td>NaN</td>
<td>NaN</td>
<td>Worse</td>
<td>Not compared</td>
<td>20150000</td>
<td>NaN</td>
<td>NaN</td>
<td>1y</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>92772</td>
<td>Premises licensed to sell alcohol per square k...</td>
<td>E92000001</td>
<td>England</td>
<td>E06000003</td>
<td>Redcar and Cleveland</td>
<td>Counties &amp; UAs (from Apr 2023)</td>
<td>Not applicable</td>
<td>Not applicable</td>
<td>NaN</td>
<td>...</td>
<td>361.0</td>
<td>244.8202</td>
<td>NaN</td>
<td>NaN</td>
<td>Worse</td>
<td>Not compared</td>
<td>20150000</td>
<td>NaN</td>
<td>NaN</td>
<td>1y</td>
</tr>
</tbody>
</table>

<p>5 rows × 27 columns</p>
</div>
</div>
</div>
<section id="lets-check-whether-it-has-included-all-geographies-by-getting-a-list-of-unique-area-types" class="level4">
<h4 class="anchored" data-anchor-id="lets-check-whether-it-has-included-all-geographies-by-getting-a-list-of-unique-area-types">Let’s check whether it has included all geographies by getting a list of unique area types</h4>
<div id="cell-geog-set" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="bu">set</span>(licensed_premises_all_geographies[<span class="st">'Area Type'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="geog-set" class="cell-output cell-output-display" data-execution_count="9">
<pre><code>{'Counties &amp; UAs (2021/22-2022/23)',
 'Counties &amp; UAs (from Apr 2023)',
 'Districts &amp; UAs (2021/22-2022/23)',
 'Districts &amp; UAs (from Apr 2023)',
 'England',
 'Regions (statistical)'}</code></pre>
</div>
</div>
</section>
</section>
<section id="lets-put-all-this-together-and-visualise-it-on-a-map" class="level3">
<h3 class="anchored" data-anchor-id="lets-put-all-this-together-and-visualise-it-on-a-map">Let’s put all this together and visualise it on a map</h3>
<p>We will need to import some more packages:</p>
<ul>
<li><a href="https://geopandas.org/en/stable/docs.html">Geopandas</a>: supports combining geographical data with <code>pandas</code> DataFrames.</li>
<li><a href="https://contextily.readthedocs.io/en/latest/index.html">Contextily</a>: used for laying maps over geographical shapes, such as maps provided by <a href="https://www.openstreetmap.org/about">OpenStreetMap</a>.</li>
<li><a href="https://matplotlib.org/3.5.3/api/_as_gen/matplotlib.pyplot.html">Matplotlib</a>: user for applying shading to geographical shapes, adding a legend and any other useful chart elements.</li>
</ul>
<div id="import-geopandas" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> contextily <span class="im">as</span> cx</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Let’s plot “Child Poverty, Income deprivation affecting children index (IDACI) 2019 Proportion %” in Bracknell Forest Local Authority area by MSOA. Let’s imagine we found this metric on the Fingertips website and want to import the data so that we can create a custom visualisation to go into some background narrative to a report.</p>
<p>Firstly, we need the profile ID for the Profile “Local health, public health data for small geographic areas”. Then we can get the profile metadata as a dataframe so that we can see how the metric we are interested is referred to within the dataset.</p>
<div id="cell-get-idaci" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>small_geographic_areas_md <span class="op">=</span> ftp.metadata.get_profile_by_name(<span class="st">'Local health, public health data for small geographic areas'</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># access the profile ID in the metadata dictionary</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>small_geographic_areas_id <span class="op">=</span> small_geographic_areas_md[<span class="st">'Id'</span>]</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># get a metadata dataframe for the profile in question</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>small_geographic_areas_md_df <span class="op">=</span> ftp.metadata.get_metadata_for_profile_as_dataframe(small_geographic_areas_id)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># get the indicator ID and name where the name contains "IDACI"</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>idaci <span class="op">=</span> small_geographic_areas_md_df[[<span class="st">'Indicator ID'</span>,<span class="st">'Indicator'</span>]][small_geographic_areas_md_df[<span class="st">'Indicator'</span>].<span class="bu">str</span>.contains(<span class="st">'IDACI'</span>)]</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect the metrics in our "idaci" variable</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>idaci</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="get-idaci" class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Indicator ID</th>
<th data-quarto-table-cell-role="th">Indicator</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">6</th>
<td>93094</td>
<td>Children in poverty: Income Deprivation Affect...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>There’s only one indicator with “IDACI” in the name, so we can go ahead and use the indicator ID to get the data for the metric we are interested in at MSOA level.</p>
<div id="cell-idaci-df" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>idaci_id <span class="op">=</span> idaci[<span class="st">'Indicator ID'</span>].iloc[<span class="dv">0</span>] <span class="co"># gets the entry from the Indicator ID column</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>idaci_df <span class="op">=</span> pd.DataFrame(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    ftp.retrieve_data.get_data_by_indicator_ids(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>        idaci_id,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>        <span class="dv">3</span>, <span class="co"># MSOA</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>        <span class="dv">501</span> <span class="co"># Local Authority</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>idaci_df.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="idaci-df" class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Indicator ID</th>
<th data-quarto-table-cell-role="th">Indicator Name</th>
<th data-quarto-table-cell-role="th">Parent Code</th>
<th data-quarto-table-cell-role="th">Parent Name</th>
<th data-quarto-table-cell-role="th">Area Code</th>
<th data-quarto-table-cell-role="th">Area Name</th>
<th data-quarto-table-cell-role="th">Area Type</th>
<th data-quarto-table-cell-role="th">Sex</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">Category Type</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Count</th>
<th data-quarto-table-cell-role="th">Denominator</th>
<th data-quarto-table-cell-role="th">Value note</th>
<th data-quarto-table-cell-role="th">Recent Trend</th>
<th data-quarto-table-cell-role="th">Compared to England value or percentiles</th>
<th data-quarto-table-cell-role="th">Compared to Districts &amp; UAs (from Apr 2023) value or percentiles</th>
<th data-quarto-table-cell-role="th">Time period Sortable</th>
<th data-quarto-table-cell-role="th">New data</th>
<th data-quarto-table-cell-role="th">Compared to goal</th>
<th data-quarto-table-cell-role="th">Time period range</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>93094</td>
<td>Children in poverty: Income Deprivation Affect...</td>
<td>NaN</td>
<td>NaN</td>
<td>E92000001</td>
<td>England</td>
<td>England</td>
<td>Persons</td>
<td>&lt;16 yrs</td>
<td>NaN</td>
<td>...</td>
<td>1777641.757</td>
<td>10405050</td>
<td>NaN</td>
<td>Cannot be calculated</td>
<td>Not compared</td>
<td>Not compared</td>
<td>20190000</td>
<td>NaN</td>
<td>NaN</td>
<td>1y</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>93094</td>
<td>Children in poverty: Income Deprivation Affect...</td>
<td>E92000001</td>
<td>England</td>
<td>E06000001</td>
<td>Hartlepool</td>
<td>Districts &amp; UAs (from Apr 2023)</td>
<td>Persons</td>
<td>&lt;16 yrs</td>
<td>NaN</td>
<td>...</td>
<td>4978.719</td>
<td>17580</td>
<td>NaN</td>
<td>Cannot be calculated</td>
<td>Worse</td>
<td>Not compared</td>
<td>20190000</td>
<td>NaN</td>
<td>NaN</td>
<td>1y</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>93094</td>
<td>Children in poverty: Income Deprivation Affect...</td>
<td>E92000001</td>
<td>England</td>
<td>E06000002</td>
<td>Middlesbrough</td>
<td>Districts &amp; UAs (from Apr 2023)</td>
<td>Persons</td>
<td>&lt;16 yrs</td>
<td>NaN</td>
<td>...</td>
<td>9359.504</td>
<td>28622</td>
<td>NaN</td>
<td>Cannot be calculated</td>
<td>Worse</td>
<td>Not compared</td>
<td>20190000</td>
<td>NaN</td>
<td>NaN</td>
<td>1y</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>93094</td>
<td>Children in poverty: Income Deprivation Affect...</td>
<td>E92000001</td>
<td>England</td>
<td>E06000003</td>
<td>Redcar and Cleveland</td>
<td>Districts &amp; UAs (from Apr 2023)</td>
<td>Persons</td>
<td>&lt;16 yrs</td>
<td>NaN</td>
<td>...</td>
<td>6195.212</td>
<td>24210</td>
<td>NaN</td>
<td>Cannot be calculated</td>
<td>Worse</td>
<td>Not compared</td>
<td>20190000</td>
<td>NaN</td>
<td>NaN</td>
<td>1y</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>93094</td>
<td>Children in poverty: Income Deprivation Affect...</td>
<td>E92000001</td>
<td>England</td>
<td>E06000004</td>
<td>Stockton-on-Tees</td>
<td>Districts &amp; UAs (from Apr 2023)</td>
<td>Persons</td>
<td>&lt;16 yrs</td>
<td>NaN</td>
<td>...</td>
<td>7965.449</td>
<td>38168</td>
<td>NaN</td>
<td>Cannot be calculated</td>
<td>Worse</td>
<td>Not compared</td>
<td>20190000</td>
<td>NaN</td>
<td>NaN</td>
<td>1y</td>
</tr>
</tbody>
</table>

<p>5 rows × 27 columns</p>
</div>
</div>
</div>
<p>Now we can import the data for the geographic mapping. For this we will use a .geojson boundary shape file downloaded from the <a href="https://geoportal.statistics.gov.uk/">Open Geography Portal</a>.</p>
<div id="cell-import-geojson" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> gpd.read_file(<span class="st">'data/MSOA_Dec_2011_Boundaries_Super_Generalised_Clipped_BSC_EW_V3_2022_-5254045062471510471.geojson'</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>gdf.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="import-geojson" class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">OBJECTID</th>
<th data-quarto-table-cell-role="th">MSOA11CD</th>
<th data-quarto-table-cell-role="th">MSOA11NM</th>
<th data-quarto-table-cell-role="th">MSOA11NMW</th>
<th data-quarto-table-cell-role="th">BNG_E</th>
<th data-quarto-table-cell-role="th">BNG_N</th>
<th data-quarto-table-cell-role="th">LONG</th>
<th data-quarto-table-cell-role="th">LAT</th>
<th data-quarto-table-cell-role="th">GlobalID</th>
<th data-quarto-table-cell-role="th">geometry</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">0</th>
<td>1</td>
<td>E02000001</td>
<td>City of London 001</td>
<td>City of London 001</td>
<td>532378</td>
<td>181354</td>
<td>-0.093570</td>
<td>51.51560</td>
<td>a9f03568-7a0a-42b8-a23e-1271f76431e1</td>
<td>POLYGON ((-0.08519 51.52034, -0.07845 51.52151...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">1</th>
<td>2</td>
<td>E02000002</td>
<td>Barking and Dagenham 001</td>
<td>Barking and Dagenham 001</td>
<td>548267</td>
<td>189693</td>
<td>0.138759</td>
<td>51.58659</td>
<td>f0ca54f0-1a1e-4c72-8fcb-85e21be6de79</td>
<td>POLYGON ((0.14984 51.59701, 0.15111 51.58708, ...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2</th>
<td>3</td>
<td>E02000003</td>
<td>Barking and Dagenham 002</td>
<td>Barking and Dagenham 002</td>
<td>548259</td>
<td>188522</td>
<td>0.138150</td>
<td>51.57607</td>
<td>3772a2ec-b052-4000-b62b-2c85ac401a7f</td>
<td>POLYGON ((0.14841 51.58075, 0.14978 51.5697, 0...</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3</th>
<td>4</td>
<td>E02000004</td>
<td>Barking and Dagenham 003</td>
<td>Barking and Dagenham 003</td>
<td>551004</td>
<td>186418</td>
<td>0.176830</td>
<td>51.55644</td>
<td>3388e1f6-e578-4907-b271-168756f05856</td>
<td>POLYGON ((0.19021 51.55268, 0.18602 51.54754, ...</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">4</th>
<td>5</td>
<td>E02000005</td>
<td>Barking and Dagenham 004</td>
<td>Barking and Dagenham 004</td>
<td>548733</td>
<td>186827</td>
<td>0.144269</td>
<td>51.56071</td>
<td>1af0aed4-60d0-4fd6-b326-4b868968c12f</td>
<td>POLYGON ((0.15441 51.56607, 0.1479 51.56109, 0...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Next, we join it to the Fingertips data so that the metric data and the geographical data are all in one dataframe.</p>
<div id="cell-merge-geojson" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>boundary_df <span class="op">=</span> pd.merge(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    left<span class="op">=</span> gdf,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    right<span class="op">=</span> idaci_df,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    left_on<span class="op">=</span> <span class="st">'MSOA11CD'</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    right_on<span class="op">=</span> <span class="st">'Area Code'</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span> <span class="st">'right'</span> </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>boundary_df <span class="op">=</span> boundary_df[boundary_df[<span class="st">'Parent Name'</span>] <span class="op">==</span> <span class="st">'Bracknell Forest'</span>] <span class="co"># just get data where the parent area (i.e. local authority) is Bracknell Forest</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>boundary_df.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div id="merge-geojson" class="cell-output cell-output-display" data-execution_count="14">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">OBJECTID</th>
<th data-quarto-table-cell-role="th">MSOA11CD</th>
<th data-quarto-table-cell-role="th">MSOA11NM</th>
<th data-quarto-table-cell-role="th">MSOA11NMW</th>
<th data-quarto-table-cell-role="th">BNG_E</th>
<th data-quarto-table-cell-role="th">BNG_N</th>
<th data-quarto-table-cell-role="th">LONG</th>
<th data-quarto-table-cell-role="th">LAT</th>
<th data-quarto-table-cell-role="th">GlobalID</th>
<th data-quarto-table-cell-role="th">geometry</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Count</th>
<th data-quarto-table-cell-role="th">Denominator</th>
<th data-quarto-table-cell-role="th">Value note</th>
<th data-quarto-table-cell-role="th">Recent Trend</th>
<th data-quarto-table-cell-role="th">Compared to England value or percentiles</th>
<th data-quarto-table-cell-role="th">Compared to Districts &amp; UAs (from Apr 2023) value or percentiles</th>
<th data-quarto-table-cell-role="th">Time period Sortable</th>
<th data-quarto-table-cell-role="th">New data</th>
<th data-quarto-table-cell-role="th">Compared to goal</th>
<th data-quarto-table-cell-role="th">Time period range</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">3497</th>
<td>3263.0</td>
<td>E02003352</td>
<td>Bracknell Forest 001</td>
<td>Bracknell Forest 001</td>
<td>491853.0</td>
<td>172163.0</td>
<td>-0.67980</td>
<td>51.44102</td>
<td>3c549766-9728-4db5-b739-7c766b7413c1</td>
<td>POLYGON ((-0.65676 51.46149, -0.65822 51.44932...</td>
<td>...</td>
<td>34.968</td>
<td>1018</td>
<td>NaN</td>
<td>Cannot be calculated</td>
<td>Better</td>
<td>Better</td>
<td>20190000</td>
<td>NaN</td>
<td>NaN</td>
<td>1y</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3498</th>
<td>3264.0</td>
<td>E02003353</td>
<td>Bracknell Forest 002</td>
<td>Bracknell Forest 002</td>
<td>486081.0</td>
<td>171506.0</td>
<td>-0.76298</td>
<td>51.43602</td>
<td>ae2b8239-e38a-4f1c-90fe-f290fbc538e8</td>
<td>POLYGON ((-0.75275 51.46223, -0.74107 51.45887...</td>
<td>...</td>
<td>64.414</td>
<td>1752</td>
<td>NaN</td>
<td>Cannot be calculated</td>
<td>Better</td>
<td>Better</td>
<td>20190000</td>
<td>NaN</td>
<td>NaN</td>
<td>1y</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">3499</th>
<td>3265.0</td>
<td>E02003354</td>
<td>Bracknell Forest 003</td>
<td>Bracknell Forest 003</td>
<td>487683.0</td>
<td>170212.0</td>
<td>-0.74026</td>
<td>51.42414</td>
<td>31f3071a-3138-4059-b9cd-279441b78d10</td>
<td>POLYGON ((-0.72071 51.41979, -0.72078 51.41927...</td>
<td>...</td>
<td>117.612</td>
<td>2124</td>
<td>NaN</td>
<td>Cannot be calculated</td>
<td>Better</td>
<td>Better</td>
<td>20190000</td>
<td>NaN</td>
<td>NaN</td>
<td>1y</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">3500</th>
<td>3266.0</td>
<td>E02003355</td>
<td>Bracknell Forest 004</td>
<td>Bracknell Forest 004</td>
<td>486030.0</td>
<td>169758.0</td>
<td>-0.76414</td>
<td>51.42031</td>
<td>74e3802a-22fa-476d-9574-9987b0adabb0</td>
<td>POLYGON ((-0.75417 51.41869, -0.76013 51.41353...</td>
<td>...</td>
<td>234.014</td>
<td>1515</td>
<td>NaN</td>
<td>Cannot be calculated</td>
<td>Similar</td>
<td>Worse</td>
<td>20190000</td>
<td>NaN</td>
<td>NaN</td>
<td>1y</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">3501</th>
<td>3267.0</td>
<td>E02003356</td>
<td>Bracknell Forest 005</td>
<td>Bracknell Forest 005</td>
<td>490476.0</td>
<td>167562.0</td>
<td>-0.70078</td>
<td>51.39988</td>
<td>3905ed89-433e-4322-8e30-e7c16404ebe1</td>
<td>POLYGON ((-0.68535 51.40142, -0.66763 51.38457...</td>
<td>...</td>
<td>46.210</td>
<td>1470</td>
<td>NaN</td>
<td>Cannot be calculated</td>
<td>Better</td>
<td>Better</td>
<td>20190000</td>
<td>NaN</td>
<td>NaN</td>
<td>1y</td>
</tr>
</tbody>
</table>

<p>5 rows × 37 columns</p>
</div>
</div>
</div>
<p>Finally, we can plot the data onto OpenStreetMap using the <code>contextily</code> package.</p>
<p><code>matplotlib.pyplot</code> plots the boundary shapes coloured by percentage using the polygon geometry data from the geopandas dataframe.</p>
<div id="cell-plot-map" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> boundary_df.plot(column<span class="op">=</span> <span class="st">'Value'</span>, legend<span class="op">=</span><span class="va">True</span>, alpha <span class="op">=</span> <span class="fl">0.6</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>ax.axis(<span class="st">'off'</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Percentage of Children Affected by Poverty in Bracknell Forest'</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>cx.add_basemap(</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    ax,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    crs<span class="op">=</span>boundary_df.crs.to_string()</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="fingertips_py_files/figure-html/plot-map-output-1.png" id="plot-map" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Created and maintained by the <a href="mailto:scwcsu.analytics.specialist@nhs.net">Specialist Analytics Team</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This page was built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>